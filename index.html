<head>
    <link id="pagestyle" href="Default.css" rel="stylesheet" type="text/css">
    <link id="pagelogic" href="Default.css" rel="stylesheet" type="text/css"> 
    <script src="replace2.js"></script>
    <script src="questionnaire.js"></script>
</head>

    <h3>
        <a href="https://github.com/episphere/quest" target="_blank">quest.js</a> - questionnaire markup demo
    </h3>

    <table>
        <thead>
            <tr>
                <td>
                    <div id=legend style="border: 1px solid black; padding-right: 5px; padding-left:5px; width:500px;" width="250px">
                        <h3>Legend</h3>
                        <p>To initialize a question, start by typing any capital letters or numbers in brackets i.e. [A-Z 0-9] or by typing a capital letter and a number followed by a period i.e. Q1.</p>
                        <p>Check Box = * or []</p>
                        <p>Radio Button = ()</p>
                        <p>Age = |__|__|</p>
                        <p>Year = |__|__|__|__|</p>
                        <p>Input Box = |__| (two underlines)</p>
                        <p>Text Box = [text box] or |___| (three underlines)</p>
                    </div>
                </td>
                <td>
                    <div id=styling style="border: 1px solid black; width:500px; height:333px; padding-left: 5px;">
                        <h3>Styling</h3>
                        <input type="radio" id="styling" name="styling" onclick="changeStyle('Default.css')" checked>No Style</input>
                        <input type="radio" id="styling" name="styling" onclick="changeStyle('Style1.css')">With Style 1</input>
                        <script>
                            function changeStyle(sheet) {
                                document.getElementById("pagestyle").setAttribute("href", sheet)
                            }
                        </script>
                        <h3>Logic</h3>
                        <input type="radio" id="styling" name="logic" onclick="changeLogic('Default.css')" checked>Not Active</input>
                        <input type="radio" id="styling" name="logic" onclick="changeLogic('ActiveLogic.css')">Active</input>
                        <script>
                            function changeLogic(sheet) {
                                document.getElementById("pagelogic").setAttribute("href", sheet)
                            }
                        </script>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <h3>markup (<a href="?questionnaires/demo.txt" id="demo">demo</a>)</h3>
                </td>
                <td style="color: navy;">
                    <h3>quest.js rendering</h3>
                </td>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td id="markup" style="vertical-align:top">
                    <textarea id="ta"></textarea>
                    <div id="loadSaveDiv">
                        <input id="file" type="file" style="margin-top: 15px;" onchange="onFileSelected(event)">
                        <br>
                        <span>Enter URL:</span>
                        <input id="url" style="margin-top: 10px;" onchange="submitURL()">
                        <input type="submit" onclick="submitURL()"></input>
                        <br>
                        <span>File Name:</span>
                        <input id="tb" style="margin-top: 10px;">
                        <span>.txt</span>
                        <button onclick="saveDoc()">Save</button>
                    </div>
                </td>
                <script>
                    function saveDoc() {
                        let bb = new Blob([ta.value])
                        let url = URL.createObjectURL(bb);
                        let a = document.createElement('a');
                        a.href = url;
                        let tb = document.getElementById('tb')
                        if(tb.value == 0){tb.value = "demo"}
                        a.download = tb.value;
                        a.click() // then download it automatically 
                        return a
                     }
                </script>
                <script>
                    function submitURL(){
                        let url = document.getElementById("url").value
                        location.search = url
                    }
                </script>
                <script>
                    function onFileSelected(event){
                        let file = event.target.files[0]
                        let reader = new FileReader()
                        reader.onload = function(event){
                            let ta = document.getElementById("ta")
                            ta.value = event.target.result
                            ta.onkeyup()
                        }
                        reader.readAsText(file)

                    }
                </script>
                <td id="rendering" style="vertical-align:top; width:650px;"></td>
            </tr>
        </tbody>
    </table>

    <script>
        (async function() {
            console.log("local anonymous");
            var ta = document.querySelector("textarea");
            ta.style.height = 600;
            ta.style.width = 500;
            //ta.style.position='fixed'
            ta.style.backgroundColor = "#FAE5D3";
            ta.style.color = "navy";

            ta.onkeyup = ev => {
                transform.tout(() => {
                    rendering.innerHTML = transform.render(ta.value + "[END]") // <-- this is where quest.js is engaged
                    if (document.querySelector(".question") != null) {
                        document.querySelector(".question").classList.add("active")
                    }
                })
            }


            ta.innerHTML = "// type, paste, or upload questionnaire markup\n\n";

    
            var q = (location.search + location.hash).replace(/[\#\?]/g, "");
            if (q.length > 3) {
                ta.value = await (await fetch(q.split("&")[0])).text(); // getting the first of markup&css
                ta.onkeyup();
            }
            ta.style.width =
                parseInt(ta.parentElement.style.width.slice(0, -1)) - 5 + "%";
        })();
    </script>